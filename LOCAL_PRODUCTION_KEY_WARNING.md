# ⚠️ 本地使用生产密钥的警告和指南

## 🚨 重要警告

**技术上可以使用生产密钥，但强烈不推荐！**

---

## ❌ 为什么不推荐？

### 1. 会产生真实费用
- 每次测试都会产生真实的交易
- 即使取消支付，也可能产生手续费
- 测试过程中可能产生意外费用

### 2. 影响生产数据
- 测试交易会出现在 Stripe Dashboard 的生产环境中
- 可能影响真实的业务数据统计
- 难以区分测试和真实交易

### 3. 安全风险
- 本地环境相对不安全
- 密钥可能被泄露（日志、缓存等）
- 代码错误可能导致意外交易

### 4. 调试困难
- 生产环境的问题更难调试
- 需要更谨慎，不能随意测试

---

## ✅ 推荐做法

### 方案 1：使用测试密钥（强烈推荐）

**优势**：
- ✅ 不会产生真实费用
- ✅ 可以使用测试卡号
- ✅ 安全，可以随意测试
- ✅ 不影响生产数据

**配置**：
```env
# .env.local
STRIPE_SECRET_KEY=sk_test_...  # 测试密钥
```

### 方案 2：使用测试模式 + 生产密钥（如果必须）

如果你**必须**在本地测试生产环境的行为：

1. **在 Stripe Dashboard 中切换到 Test Mode**
   - 即使使用生产密钥，在 Test Mode 下也不会产生真实费用
   - 但这不是标准做法

2. **使用环境变量区分**
   ```env
   # .env.local
   STRIPE_SECRET_KEY=sk_live_...  # 生产密钥
   STRIPE_MODE=test  # 强制使用测试模式
   ```

---

## 🔧 如果一定要使用生产密钥

### 安全措施

1. **使用单独的环境变量文件**
   ```bash
   # 创建 .env.production.local（不提交到 Git）
   STRIPE_SECRET_KEY=sk_live_...
   ```

2. **限制使用范围**
   - 只在必要时使用
   - 测试完成后立即切换回测试密钥
   - 不要长时间使用

3. **监控交易**
   - 实时监控 Stripe Dashboard
   - 设置交易通知
   - 记录所有测试交易

4. **使用最小金额测试**
   - 只用 $0.99 的套餐测试
   - 避免大额测试

5. **及时撤销**
   - 测试完成后立即撤销密钥
   - 或创建新的密钥

---

## 📋 最佳实践

### 开发流程

```
1. 本地开发 → 使用测试密钥 (sk_test_...)
   ↓
2. 本地测试 → 使用测试密钥 + 测试卡号
   ↓
3. 部署到 Vercel (Preview) → 使用测试密钥
   ↓
4. 验证通过后 → 部署到 Production → 使用生产密钥
   ↓
5. 生产环境测试 → 使用生产密钥 + 真实小额支付
```

### 环境变量管理

**本地开发 (.env.local)**：
```env
STRIPE_SECRET_KEY=sk_test_...  # 测试密钥
```

**Vercel Preview 环境**：
```env
STRIPE_SECRET_KEY=sk_test_...  # 测试密钥
```

**Vercel Production 环境**：
```env
STRIPE_SECRET_KEY=sk_live_...  # 生产密钥
```

---

## 🎯 推荐测试策略

### 阶段 1：本地测试（使用测试密钥）

```bash
# .env.local
STRIPE_SECRET_KEY=sk_test_...

# 使用测试卡号
卡号: 4242 4242 4242 4242
```

### 阶段 2：Vercel Preview 测试（使用测试密钥）

- 部署到 Vercel Preview 环境
- 使用测试密钥
- 完整测试流程

### 阶段 3：生产环境测试（使用生产密钥）

- 部署到 Production
- 使用生产密钥
- 进行**一次**小额真实支付测试（$0.99）
- 验证成功后正式上线

---

## ⚠️ 如果使用生产密钥的检查清单

- [ ] 已充分测试（使用测试密钥）
- [ ] 代码已审查
- [ ] 错误处理完善
- [ ] 监控已设置
- [ ] 准备撤销密钥（如果需要）
- [ ] 使用最小金额测试
- [ ] 实时监控 Stripe Dashboard
- [ ] 测试完成后立即切换回测试密钥

---

## 💡 我的建议

**强烈建议：只在本地使用测试密钥**

原因：
1. 测试密钥功能完全一样
2. 不会产生费用
3. 更安全
4. 可以随意测试

**生产密钥只在以下情况使用**：
- 部署到 Vercel Production 环境后
- 进行最终验证时
- 正式上线后

---

## 🔒 安全提示

如果必须使用生产密钥：

1. ✅ 不要在代码中硬编码
2. ✅ 使用环境变量
3. ✅ 确保 `.env.local` 在 `.gitignore` 中
4. ✅ 不要提交到 Git
5. ✅ 不要分享给他人
6. ✅ 测试完成后立即撤销或切换

---

## 📞 需要帮助？

如果遇到问题：
- 查看 Stripe Dashboard 中的交易记录
- 检查 Vercel 日志
- 参考 Stripe 文档

记住：**安全第一，测试密钥足够用于开发！** 🛡️

